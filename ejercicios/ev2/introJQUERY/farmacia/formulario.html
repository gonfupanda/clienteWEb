<html>
    <head>
        <title>farmacia</title>
        <!--Boodstrap CSS-->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" 
        rel="stylesheet" integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" 
        crossorigin="anonymous">
        <!--Boodstrap-->
        <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
        <style>/*CSS*/
            body{background-image: url("fondo.jpg");}
            h1{font-family: "Times New Roman";text-decoration: underline;color: azure;text-align: center;}
            p{color: azure}
            label{font-family: "Times New Roman";text-decoration: underline;color: blanchedalmond}
            textarea{width: 900px;}
            h3{font-family: "Times New Roman";color: darkslateblue;}
            td {text-align: center;border-spacing: 30px;}
            #cuerpo{width: 600px;background-color: rgb(43, 35, 35);border-radius: 5px;box-shadow: 10px 10px 5px grey;}

            label.error{color:red;font-size: 8px;}
            input.error{border: 2px dotted red;}
        </style>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <!--<script src="operaciones.js"></script>-->
        <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.3/dist/jquery.validate.js"></script>
        <script src="https://cdn.jsdelivr.net/jquery.validation/1.16.0/additional-methods.min.js"></script>

</body>
</html>
    </head>
    <body>
        <!--Boodstrap JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js" 
        integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ" 
        crossorigin="anonymous"></script>
        <br><br><br>

        <div class="container-xxl" class="mx-auto" id="cuerpo">

            <div class="container-xxl capaSec" id="ingresar"><!--Alta usuarios AUTORIZADOS-->
                <form id="formUsu">
                    <table width="25%" border="0" align="center" id="principal">
                        <tr><!--nombre usuario-->
                            <br>
                            <label for="exampleInputPassword1" class="form-label">Nombre:</label>
                            <input type="text" class="form-control" name="AA" id="AA" required>
                        </tr>
                        <tr><!--nombre usuario-->
                            <br>
                            <label for="exampleInputPassword1" class="form-label">Nombre:</label>
                            <input type="text" class="form-control" name="nomIngresar" id="nomIngresar" required>
                        </tr>
                        <tr><!--botones-->
                            <br><br>
                            <input class="btn btn-primary" type="button" value="Continuar" onclick="entrar()">
                            <input type="button" class="btn btn-secondary" value="Volver" onclick="volver_menu(1)"  >
                        </tr>
                    </table>
                </form>
            </div>
 
            <div class="container-xxl" id="menu"><!--Menu-->
                <div class="row">
                    <div class="col-9"><h1>Farmacia</h1></div>
                    
                    <table class="table table-dark">
                        <tbody>
                          <tr class="table-active">
                             <td rowspan="3" colspan="3"> <img id="imagen" src="farmacia.png" width="300" height="300" style="text-align: center;"/></td>
                             <td ><input type="button" class="btn btn-primary operacion" id="btnVentas" value="Ventas" style="width: 200px;" onclick="navVentas()"></td>    
                          </tr>
                          <tr class="table-active">
                            <td ><input type="button" class="btn btn-primary operacion" id="btnCompras" value="Compras" style="width: 200px;"onclick="navCompras()"></td>
                         </tr>
                          <tr class="table-active">
                             <td ><input type="submit" class="btn btn-primary operacion" id="btnPedidos" value="Pedidos" style="width: 200px;" onclick="navPedidos()"></td>
                          </tr>                           
                        </tbody>
                      </table>
                      <br>
                      <div><input type="button" class="btn btn-success " id="btnIngresar" value="Ingresar" onclick="ingresarForm()" style="width: 180px;" ></div>
                </div>
                <br>                        
            </div>
            <div class="container-xxl capaSec" id="ventas"><!--VENTAS-->
                <form id="formVentas">
                    <table width="25%" border="0" align="center" id="principal">
                        <tr><!--identificador producto-->
                            <label class="form-label"> Identificador:</label>
                            <input type="text" class="form-control" name="nameIdVentas" id="idVentas" required>

                        </tr>
                        <tr><!--cantidad ventas-->
                            <br>
                            <label for="exampleInputPassword1" class="form-label">Cantidad:</label>
                            <input type="text" class="form-control"  name="nameCantVentas" id="cantVenta" required>
                        </tr>
                        <tr><!--botones-->
                            <br><br>
                            <input class="btn btn-primary" type="button" value="Continuar" onclick="venta()">
                            <input type="button" class="btn btn-secondary" value="Volver" onclick="volver_menu(2)"  >
                        </tr>
                    </table>
                </form>

            </div>
            <div class="container-xxl capaSec" id="compras"><!--COMPRAS-->
                <form id="formCompraId">  <!--identificador producto-->
                    <label for="validationCustom03" class="form-label"> Identificador:</label>
                    <input type="text" class="form-control" name="nameIdCompra" id="idCompra" placeholder=" Identificador Producto" required >
                    <br><br>
                    <input class="btn btn-primary" type="button" value="Continuar" onclick="comprar()">
                    <input type="button" class="btn btn-secondary" value="Volver" onclick="volver_menu(3)"  >
                </form>
                <form id="formCompra" class="existe">
                
                    <table width="25%" border="0" align="center" id="principal" >
                        <!--identificador producto-->
                           
                       
                        <tr><!--nombre producto-->
                            <br>
                            <label for="validationCustom03" class="form-label"> Nombre:</label>
                            <input type="text" class="form-control" name="nameNom" id="NomCompra" placeholder=" Nombre Producto" required >

                        </tr>
                        <tr><!--precio producto-->
                            <br>
                            <label for="exampleInputPassword1" class="form-label">Precio Compra:</label>
                            <input type="text" class="form-control" name="namePrecioCompra" id="precioProducto" required>
                        </tr>
                        <tr><!--cantidad producto-->
                            <br>
                            <label for="exampleInputPassword1" class="form-label">Cantidad:</label>
                            <input type="text" class="form-control" name="nameCantProducto" id="cantProducto" required>
                        </tr>
                        <tr><!--botones-->
                            <br><br>
                            <input class="btn btn-primary" type="button" value="Continuar" onclick="mod()">
                            <input type="button" class="btn btn-secondary" value="Volver" onclick="compraInicial()"  >
                        </tr>
                    </table>

                </form>
                <form id="formCompraNueva" class="noexiste">
                
                    <table width="25%" border="0" align="center" id="principal" >                           
                       
                        <tr><!--nombre producto-->
                            <br>
                            <label for="validationCustom03" class="form-label"> Nombre:</label>
                            <input type="text" class="form-control" name="nameNomNuevo" id="nameNomNuevo" placeholder=" Nombre Producto" required >

                        </tr>
                        <tr><!--farmaceutica-->
                            <br>
                            <label for="validationCustom03" class="form-label"> Farmaceutica:</label>
                            <input type="text" class="form-control" name="nameFarma" id="nameFarma" placeholder="" required >

                        </tr>
                        <tr><!--precio producto Compra-->
                            <br>
                            <label for="exampleInputPassword1" class="form-label">Precio Compra:</label>
                            <input type="text" class="form-control" name="namePrecioCompraNuevo" id="namePrecioCompraNuevo" required>
                        </tr>
                        <tr><!--precio producto Venta-->
                            <br>
                            <label for="exampleInputPassword1" class="form-label">Precio Venta:</label>
                            <input type="text" class="form-control" name="namePrecioVentaNuevo" id="namePrecioVentaNuevo" required>
                        </tr>
                        <tr><!--cantidad producto-->
                            <br>
                            <label for="exampleInputPassword1" class="form-label">Cantidad:</label>
                            <input type="text" class="form-control" name="nameCantProductoNuevo" id="nameCantProductoNuevo" required>
                        </tr>
                        <tr><!--botones-->
                            <br><br>
                            <input class="btn btn-primary" type="button" value="Continuar" onclick="crear()">
                            <input type="button" class="btn btn-secondary" value="Volver" onclick="compraInicial()">
                        </tr>
                    </table>

                </form>
            </div>
            <div class="containner-xxl capaSec" id="pedidos"><!--PEDIDOS-->
                <h1>Productos con Stock de 5 o menos</h1>
                <br>
                <textarea id ="areatxt" name="area" rows="6" readonly style="width: 500px;"></textarea>
                <br>
                <div>
                    <br><br>
                    <input class="btn btn-primary" type="button" value="Continuar" onclick="mostrar()">
                    <input type="button" class="btn btn-secondary" value="Volver" onclick="volver_menu(4)"  >
                </div>
            </div>  
        </div>
        <script>
            var validador;
            var validatorUsu;
            var validatorComp;
            var indice;
           
            
            $(".operacion").hide(0);
            $(".capaSec").hide(0);
            productos=[];//array de productos

            //array de usuarios validos
            usuarios=[{id:"AAA1111",nombre:"Mikel"},{id:"BBB2222",nombre:"Gonzalo"},
            {id:"CCC3333",nombre:"Ivan"},{id:"DDD4444",nombre:"EvilRaysha"},{id:"aa",nombre:"aa"}];

            ///NAVEGACION        
            function ingresarForm(){//acceder al formulario de ingreso
                $("#menu").hide(1000);
                $("#ingresar").show(1000);
               $(document).ready(function(){
                   /* 
                    jQuery.validator.addMethod("patron_contrasena", function(value, element) {
                        return /[A-z]{3}[0-9]{3}/.test(value);
                    }, "El patron consiste de 3 letras seguidos de 3 numeros");
                    */
                    validador=$("#formUsu").validate({
                        rules:{
                           AA:{
                                required: true,
                                minlength: 2,
                                //patron_contrasena: true
                                //pattern:/[A-z]{3}[0-9]{3}/
                            },
                            nomIngresar:{
                                required: true,
                                minlength: 4
                            }
                        },
                        messages:{
                            AA:{
                                required:"Este campo es OBLIGATORIO",
                                minlength:"longitud minima 2",
                                //pattern:"El patron consiste de 3 letras seguidos de 3 numeros"
                            },
                            nomIngresar:{
                                required:"Este campo es OBLIGATORIO",
                                minlength:"longitud minima 5"
                            }
                        }
                    })                 
                });
               
                
            }
               
            function navVentas(){//acceder al formulario de ventas
                $("#menu").hide(1000);
                $("#ventas").show(1000);
                $(document).ready(function(){     //de momento esto funciona 
   
                    validator=$("#formVentas").validate({
                        rules:{
                            nameIdVentas:{
                                required: true,
                                minlength: 2

                            },
                            nameCantVentas:{
                                required:true,
                                number:true,
                                min:1
                            }
                        },
                        messages:{
                            nameIdVentas:{
                                required:"Este campo es OBLIGATORIO",
                                minlength:"longitud minima 2"
                            },
                            nameCantVentas:{
                                required:"Este campo es OBLIGATORIO",
                                number:"Debe ser numerico y sin decimal",
                                min:"Minimo 1"
                            }
                        }
                    })

                });
                
            }
            function navCompras(){//acceder al formulario de compras
                $("#menu").hide(1000);
                $("#compras").show(1000);
                $(".existe").hide(0);
                $(".noexiste").hide(0);

               $(document).ready(function(){
                validator=$("#formCompraId").validate({
                        rules:{
                            nameIdCompra:{
                                required: true,
                                minlength: 2
                                //maxlenght:24
                            },
                        },
                        messages:{
                            nameIdCompra:{
                                required:"Este campo es OBLIGATORIO",
                                minlength:"longitud minima 2",
                                //maxlenght:"Maximo de 24 caracteres"
                            },
                        }
                    })
                });
     
            } 
            function navPedidos(){
                $("#menu").hide(1000);
                $("#pedidos").show(1000);
            }

            function ingresarMenu(){//ingresar con exito en la aplicacion
                $("#ingresar").hide(1000);
                $("#menu").show(1000);
                $(".operacion").show(1000);
                $("#btnIngresar").hide(0);
            }
            function volver_menu(capa){//volver de otras capas al menu
                $("input[type=text]").val('');//limpia los input
                if(capa!=1){
                    validator.resetForm();//resetea los validations
                }
                switch(capa){
                    case 1:
                        $("#ingresar").hide(1000);                      
                        break;
                    case 2:
                        $("#ventas").hide(1000);                       
                        break;
                    case 3:
                        $("#compras").hide(1000); 
                        $(".existe").hide(0);
                        $(".noexiste").hide(0);       
                        break;
                    case 4:
                        $("#pedidos").hide(1000);                     
                        break;
                }
                $("#menu").show(1000);
            }
            function compraInicial(){
                $("input[type=text]").val('');//limpia los input
                validator.resetForm();//resetea los validations
                $(".existe").hide(1000);
                $(".noexiste").hide(1000);
            }
            ////

            ///INGRESAR
            function entrar(){//comprobar usuario valido
               ide= $("#AA").val();
                nom=$("#nomIngresar").val();
                esta=false;
                validatorUsu=validador.form();
                console.log("valor del validado del formulario de ingresar: "+validatorUsu);
                if(validatorUsu){
                    for(i=0;i<usuarios.length;i++){
                        if(usuarios[i].id==ide &&usuarios[i].nombre==nom){
                            esta=true;
                            i=usuarios.length;
                        }
                    }
                    if(!esta){
                        alert("Usuario o contraseña incorrecta");
                    }else{
                        ingresarMenu();
                        
                    }
                }                 
            }
            /// 

            ///VENTAS
            function venta(){//comprar o modificar un producto
                idVentas=$("#idVentas").val();
                cantVenta=parseInt($("#cantVenta").val());
                //console.log("idVenta="+idVentas);
                //console.log("idVenta2="+$("#idVentas").val());
                //console.log("cantVenta="+cantVenta);
                esta=false;

                for(i=0;i<productos.length;i++){
                    if(idVentas==productos[i].nombre){
                        esta=true;
                        //console.log("stock="+productos[i].cantidad);
                        if(cantVenta>productos[i].cantidad){//pregunto si hay suficiente stock
                            alert("Solo disponemos de:"+productos[i].cantidad+" unidades");
                        }else{
                            productos[i].cantidad=productos[i].cantidad-cantVenta;
                            alert("Disfrute de su compra");
                            $("#idVentas").val("");
                            $("#cantVenta").val("");
                            console.log(productos);
                            volver_menu(2); 
                        }
                      
                        i=productos.length;
                        //console.log("Producto encontrado(VENTA)");                
                    }
                }
                if(!esta){
                   
                    alert("producto no encontrado");
                }   
            }
            ///

            ///COMPRAS
           
            function comprar(){//comprobar un producto

                idcompra=$("#idCompra").val();
                esta=false;
                validatorComp=validador.form();//devuelve el estado del formulario

                if(validatorComp){
                    for(i=0;i<productos.length;i++){
                        if(productos[i].nombre==idcompra){
                            $(".existe").show();
                            $("#NomCompra").val(productos[i].comun);                          
                            $("#precioProducto").val(productos[i].preciocompra);
                            $("#cantProducto").val(productos[i].cantidad);
                            indice=i;
                            i=productos.length;
                            esta=true;

                            $(document).ready(function(){           
                        validator=$("#formCompra").validate({
                        rules:{
                            nameNom:{
                                required: true,
                                minlength: 4
                                //maxlenght:24
                            },
                            namePrecioCompra:{
                                required:true,
                                number:true,
                                min:1
                                
                            },
                            nameCantProducto:{
                                required:true,
                                number:true,
                                min:1
                            }
                        },
                        messages:{
                            nameNom:{
                                required:"Este campo es OBLIGATORIO",
                                minlength:"longitud minima 4",
                                //maxlenght:"Maximo de 24 caracteres"
                            },
                            namePrecioCompra:{
                                required:"Este campo es OBLIGATORIO",
                                number:"Debe ser numerico",
                                min:"Minimo 1"
                                
                            },
                            nameCantProducto:{
                                required:"Este campo es OBLIGATORIO",
                                number:"Debe ser numerico y sin decimal",
                                min:"Minimo 1"
                            }
                        }
                        })
                        });
                        }           
                    }
                    if(!esta){
                        $(".noexiste").show(1000);
                        $(document).ready(function(){           
                    validator=$("#formCompraNueva").validate({
                        rules:{
                            nameNomNuevo:{
                                required: true,
                                minlength: 2
                                //maxlenght:24
                            },
                            nameFarma:{
                                required: true,
                                minlength: 4
                                //maxlenght:24
                            },
                            namePrecioCompraNuevo:{
                                required:true,
                                number:true,
                                min:1
                                
                            },
                            namePrecioVentaNuevo:{
                                required:true,
                                number:true,
                                min:1
                            },
                            nameCantProductoNuevo:{
                                required:true,
                                number:true,
                                min:1
                            }
                        },
                        messages:{
                            nameNomNuevo:{
                                required:"Este campo es OBLIGATORIO",
                                minlength:"longitud minima 2",
                                //maxlenght:"Maximo de 24 caracteres"
                            },
                            nameFarma:{
                                required:"Este campo es OBLIGATORIO",
                                minlength:"longitud minima 4",
                                //maxlenght:"Maximo de 24 caracteres"
                            },
                            namePrecioCompraNuevo:{
                                required:"Este campo es OBLIGATORIO",
                                number:"Debe ser numerico",
                                min:"Minimo 1"
                                
                            },
                            namePrecioVentaNuevo:{
                                required:"Este campo es OBLIGATORIO",
                                number:"Debe ser numerico y sin decimal",
                                min:"Minimo 1"
                            },
                            nameCantProductoNuevo:{
                                required:"Este campo es OBLIGATORIO",
                                number:"Debe ser numerico y sin decimal",
                                min:"Minimo 1"
                            }
                        }
                        })
                     });  
                      
                    }
                }else{
                    alert("Introduce correctamente el formulario");
                }

               
            }

            function crear(){//nuevo medicamento
                validatorComp=validador.form();//devuelve el estado del formulario
                console.log(validatorComp);

                idcompra=$("#idCompra").val();
                nomComun=$("#nameNomNuevo").val();
                farmaciaa=$("#nameFarma").val();
                preciocompra=$("#namePrecioCompraNuevo").val();
                precioVenta=$("#namePrecioVentaNuevo").val();
                cantcompra=$("#nameCantProductoNuevo").val();
                console.log($("#nameCantProductoNuevo").val());
                console.log(document.getElementById("nameCantProductoNuevo"));
                if(validatorComp){
                    let producto ={//Objeto de medicamentos
                            nombre:idcompra,
                            comun:nomComun,
                            farmacia: farmaciaa,
                            preciocompra :preciocompra,
                            precioventa :precioVenta,
                            cantidad:cantcompra
                    };
                productos.push(producto);
                // console.log("producto nuevo introducido");
                console.log(productos);
                volver_menu(3);

                }else{
                    alert("Introduce de manera correcta el formulario");
                }

                
            }
            function mod(){//modificar medicamento
                validatorComp=validador.form();//devuelve el estado del formulario
                console.log(validatorComp);
                nombre=$("#nameNom").val();
                cantcompra=parseInt($("#cantProducto").val());
                preciocompra=parseFloat($("#precioProducto").val());
                
                for(i=0;i<productos.length;i++){
                    if(productos[i].comun==idcompra){
                        validatorComp=false;
                        i=productos.length;
                    }
                }
                if(validatorComp){
                    productos[indice].cantidad= productos[indice].cantidad+cantcompra;
                    productos[indice].preciocompra=preciocompra;
                    productos[indice].comun=nombre;
                }

            }
            ///

            ///PEDIDOS
            function mostrar(){//mostrar productos con 5 o menos cantidad
                var textarea = document.getElementById("areatxt");
                textarea.value ="";
                for(i=0;i<productos.length;i++){
                    if(productos[i].cantidad<=5){
                        //console.log("ogjetos a meter en el textarea:");
                       // console.log(productos[i]);
                        textarea.value =textarea.value+"\n"+productos[i].nombre+" "+productos[i].preciocompra+"  "+productos[i].cantidad;    
                    }                 
                }
                textarea.innerText(textarea.value);
            }
            ///   
   
        </script>
    </body>
</html>